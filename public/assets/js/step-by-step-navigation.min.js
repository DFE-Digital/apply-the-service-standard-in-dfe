window.GOVUK=window.GOVUK||{},window.GOVUK.Modules=window.GOVUK.Modules||{},function(t){function e(t){this.$module=t,this.$module.actions={},this.$module.rememberShownStep=!1,this.$module.stepNavSize=!1,this.$module.sessionStoreLink="govuk-step-nav-active-link",this.$module.activeLinkClass="app-step-nav__list-item--active",this.$module.activeStepClass="app-step-nav__step--active",this.$module.activeLinkHref="#content",this.$module.uniqueId=!1}e.prototype.init=function(){this.$module.classList.add("app-step-nav--active"),this.$module.classList.remove("js-hidden"),this.$module.stepNavSize=this.$module.classList.contains("app-step-nav--large")?"Big":"Small",this.$module.rememberShownStep=!!this.$module.hasAttribute("data-remember")&&"Big"===this.$module.stepNavSize,this.$module.steps=this.$module.querySelectorAll(".js-step"),this.$module.stepHeaders=this.$module.querySelectorAll(".js-toggle-panel"),this.$module.totalSteps=this.$module.querySelectorAll(".js-panel").length,this.$module.totalLinks=this.$module.querySelectorAll(".app-step-nav__link").length,this.$module.showOrHideAllButton=!1,this.$module.uniqueId=this.$module.getAttribute("data-id")||!1,this.$module.uniqueId&&(this.$module.sessionStoreLink=this.$module.sessionStoreLink+"_"+this.$module.uniqueId);var t=new this.StepNavTracker(this.$module.uniqueId,this.$module.totalSteps,this.$module.totalLinks);this.getTextForInsertedElements(),this.addButtonstoSteps(),this.addShowHideAllButton(),this.addShowHideToggle(),this.addAriaControlsAttrForShowHideAllButton(),this.ensureOnlyOneActiveLink(),this.showPreviouslyOpenedSteps(),this.bindToggleForSteps(t),this.bindToggleShowHideAllButton(t),this.bindComponentLinkClicks(t),this.setActiveStepClass()},e.prototype.getTextForInsertedElements=function(){this.$module.actions.showText=this.$module.getAttribute("data-show-text"),this.$module.actions.hideText=this.$module.getAttribute("data-hide-text"),this.$module.actions.showAllText=this.$module.getAttribute("data-show-all-text"),this.$module.actions.hideAllText=this.$module.getAttribute("data-hide-all-text")},e.prototype.addShowHideAllButton=function(){var t=document.createElement("div"),e=this.$module.querySelectorAll(".app-step-nav__steps")[0];t.className="app-step-nav__controls govuk-!-display-none-print",t.innerHTML='<button aria-expanded="false" class="app-step-nav__button app-step-nav__button--controls js-step-controls-button"><span class="app-step-nav__chevron app-step-nav__chevron--down js-step-controls-button-icon"></span><span class="app-step-nav__button-text app-step-nav__button-text--all js-step-controls-button-text">'+this.$module.actions.showAllText+"</span></button>",this.$module.insertBefore(t,e),this.$module.showOrHideAllButton=this.$module.querySelectorAll(".js-step-controls-button")[0]},e.prototype.addShowHideToggle=function(){for(var t=0;t<this.$module.stepHeaders.length;t++){var e,s,i,o,n,l=this.$module.stepHeaders[t];l.querySelectorAll(".js-toggle-link").length||(e=document.createElement("span"),s=document.createElement("span"),i=document.createElement("span"),o=document.createElement("span"),n=document.createElement("span"),e.className="app-step-nav__toggle-link js-toggle-link govuk-!-display-none-print",s.className="app-step-nav__button-text js-toggle-link-text",i.className="app-step-nav__chevron js-toggle-link-icon",o.className="app-step-nav__toggle-link-focus",n.className="govuk-visually-hidden",e.appendChild(o),o.appendChild(i),o.appendChild(s),n.innerHTML=" this section",e.appendChild(n),l.querySelectorAll(".js-step-title-button")[0].appendChild(e))}},e.prototype.headerIsOpen=function(t){return void 0!==t.parentNode.getAttribute("show")},e.prototype.addAriaControlsAttrForShowHideAllButton=function(){var t=this.$module.querySelectorAll(".js-panel")[0].getAttribute("id");this.$module.showOrHideAllButton.setAttribute("aria-controls",t)},e.prototype.setAllStepsShownState=function(t){for(var e=[],s=0;s<this.$module.steps.length;s++)new this.StepView(this.$module.steps[s],this.$module).setIsShown(t),t&&e.push(this.$module.steps[s].getAttribute("id"));t?this.saveToSessionStorage(this.$module.uniqueId,JSON.stringify(e)):this.removeFromSessionStorage(this.$module.uniqueId)},e.prototype.showPreviouslyOpenedSteps=function(){for(var t=this.loadFromSessionStorage(this.$module.uniqueId)||[],e=0;e<this.$module.steps.length;e++){var s=this.$module.steps[e],i=s.getAttribute("id"),o=new this.StepView(s,this.$module),s=s.hasAttribute("data-show");this.$module.rememberShownStep&&-1<t.indexOf(i)||s&&"undefined"!==s?o.setIsShown(!0):o.setIsShown(!1)}0<t.length&&(this.$module.showOrHideAllButton.setAttribute("aria-expanded",!0),this.setShowHideAllText())},e.prototype.addButtonstoSteps=function(){for(var t=0;t<this.$module.steps.length;t++){var e=this.$module.steps[t],s=e.querySelectorAll(".js-step-title")[0],e=e.querySelectorAll(".js-panel")[0].getAttribute("id"),i=s.textContent||s.innerText;s.outerHTML='<span class="js-step-title"><button class="app-step-nav__button app-step-nav__button--title js-step-title-button" aria-expanded="false" aria-controls="'+e+'"><span class="app-step-nav____title-text-focus"><span class="app-step-nav__title-text js-step-title-text">'+i+'</span><span class="govuk-visually-hidden app-step-nav__section-heading-divider">, </span></span></button></span>'}},e.prototype.bindToggleForSteps=function(i){for(var o=this,t=this.$module.querySelectorAll(".js-toggle-panel"),e=0;e<t.length;e++)t[e].addEventListener("click",function(t){var e=new o.StepView(this.parentNode,o.$module),s=(e.toggle(),this.parentNode.hasAttribute("data-optional"));new o.StepToggleClick(t,e,i,s,o.$module.stepNavSize).trackClick(),o.setShowHideAllText(),o.rememberStepState(this.parentNode)})},e.prototype.rememberStepState=function(t){var e,s;this.$module.rememberShownStep&&(e=JSON.parse(this.loadFromSessionStorage(this.$module.uniqueId))||[],s=t.getAttribute("id"),t.classList.contains("step-is-shown")?e.push(s):-1<(t=e.indexOf(s))&&e.splice(t,1),this.saveToSessionStorage(this.$module.uniqueId,JSON.stringify(e)))},e.prototype.bindComponentLinkClicks=function(s){for(var t=this.$module.querySelectorAll(".js-link"),i=this,e=0;e<t.length;e++)t[e].addEventListener("click",function(t){var e=this.getAttribute("data-position");new i.ComponentLinkClick(t,s,e,i.$module.stepNavSize).trackClick(),"external"!==this.getAttribute("rel")&&i.saveToSessionStorage(i.$module.sessionStoreLink,e),this.getAttribute("href")===i.$module.activeLinkHref&&(i.setOnlyThisLinkActive(this),i.setActiveStepClass())})},e.prototype.saveToSessionStorage=function(t,e){window.sessionStorage.setItem(t,e)},e.prototype.loadFromSessionStorage=function(t,e){return window.sessionStorage.getItem(t)},e.prototype.removeFromSessionStorage=function(t){window.sessionStorage.removeItem(t)},e.prototype.setOnlyThisLinkActive=function(t){for(var e=this.$module.querySelectorAll("."+this.$module.activeLinkClass),s=0;s<e.length;s++)e[s].classList.remove(this.$module.activeLinkClass);t.parentNode.classList.add(this.$module.activeLinkClass)},e.prototype.ensureOnlyOneActiveLink=function(){var t,e,s,i=this.$module.querySelectorAll(".js-list-item."+this.$module.activeLinkClass);i.length<=1||(e=this.loadFromSessionStorage(this.$module.sessionStoreLink),t=this.$module.querySelectorAll("."+this.$module.activeLinkClass)[0].firstChild.getAttribute("data-position"),(s=this.$module.querySelectorAll('[data-position="'+(e=e||t)+'"]')[0])?s.parentNode.classList.contains(this.$module.activeLinkClass)||(e=s):e=t,this.removeActiveStateFromAllButCurrent(i,e),this.setActiveStepClass())},e.prototype.removeActiveStateFromAllButCurrent=function(t,e){for(var s=0;s<t.length;s++){var i=t[s];i.querySelectorAll(".js-link")[0].getAttribute("data-position").toString()!==e.toString()&&(i.classList.remove(this.$module.activeLinkClass),(i=i.querySelectorAll(".visuallyhidden")).length)&&i[0].parentNode.removeChild(i[0])}},e.prototype.setActiveStepClass=function(){for(var t=this.$module.querySelectorAll("."+this.$module.activeStepClass),e=0;e<t.length;e++)t[e].classList.remove(this.$module.activeStepClass),t[e].removeAttribute("data-show");var s=this.$module.querySelectorAll("."+this.$module.activeLinkClass)[0];s&&((s=s.closest(".app-step-nav__step")).classList.add(this.$module.activeStepClass),s.setAttribute("data-show",""))},e.prototype.bindToggleShowHideAllButton=function(s){var i=this;this.$module.showOrHideAllButton.addEventListener("click",function(t){var e=(this.textContent||this.innerText)===i.$module.actions.showAllText;return s.trackClick("pageElementInteraction",e?"stepNavAllShown":"stepNavAllHidden",{label:(e?i.$module.actions.showAllText:i.$module.actions.hideAllText)+": "+i.$module.stepNavSize}),i.setAllStepsShownState(e),i.$module.showOrHideAllButton.setAttribute("aria-expanded",e),i.setShowHideAllText(),!1})},e.prototype.setShowHideAllText=function(){var t=this.$module.querySelectorAll(".step-is-shown").length,e=this.$module.showOrHideAllButton.querySelector(".js-step-controls-button-icon"),s=this.$module.showOrHideAllButton.querySelector(".js-step-controls-button-text");t===this.$module.totalSteps?(s.innerHTML=this.$module.actions.hideAllText,e.classList.remove("app-step-nav__chevron--down")):(s.innerHTML=this.$module.actions.showAllText,e.classList.add("app-step-nav__chevron--down"))},e.prototype.StepView=function(t,e){this.stepElement=t,this.stepContent=this.stepElement.querySelectorAll(".js-panel")[0],this.titleButton=this.stepElement.querySelectorAll(".js-step-title-button")[0];t=this.stepElement.querySelectorAll(".js-step-title-text")[0];this.title=t.textContent||t.innerText,this.title=this.title.replace(/^\s+|\s+$/g,""),this.showText=e.actions.showText,this.hideText=e.actions.hideText,this.upChevronSvg=e.upChevronSvg,this.downChevronSvg=e.downChevronSvg,this.show=function(){this.setIsShown(!0)},this.hide=function(){this.setIsShown(!1)},this.toggle=function(){this.setIsShown(this.isHidden())},this.setIsShown=function(t){var e=this.stepElement.querySelectorAll(".js-toggle-link")[0],s=e.querySelector(".js-toggle-link-text"),e=e.querySelector(".js-toggle-link-icon");t?(this.stepElement.classList.add("step-is-shown"),this.stepContent.classList.remove("js-hidden"),s.innerHTML=this.hideText,e.classList.remove("app-step-nav__chevron--down")):(this.stepElement.classList.remove("step-is-shown"),this.stepContent.classList.add("js-hidden"),s.innerHTML=this.showText,e.classList.add("app-step-nav__chevron--down")),this.titleButton.setAttribute("aria-expanded",t)},this.isShown=function(){return this.stepElement.classList.contains("step-is-shown")},this.isHidden=function(){return!this.isShown()},this.numberOfContentItems=function(){return this.stepContent.querySelectorAll(".js-link").length}},e.prototype.StepToggleClick=function(t,e,s,i,o){this.target=t.target,this.stepIsOptional=i,this.stepNavSize=o,this.trackClick=function(){var t={label:this.trackingLabel(),dimension28:e.numberOfContentItems().toString()};s.trackClick("pageElementInteraction",this.trackingAction(),t)},this.trackingLabel=function(){return this.target.closest(".js-step").querySelectorAll(".js-toggle-panel")[0].getAttribute("data-position")+" - "+e.title+" - "+this.locateClickElement()+": "+this.stepNavSize+this.isOptional()},this.stepIndex=function(){return this.$module.steps.index(e.element)+1},this.trackingAction=function(){return e.isHidden()?"stepNavHidden":"stepNavShown"},this.locateClickElement=function(){return this.clickedOnIcon()?this.iconType()+" click":this.clickedOnHeading()?"Heading click":"Elsewhere click"},this.clickedOnIcon=function(){return this.target.classList.contains("js-toggle-link")},this.clickedOnHeading=function(){return this.target.classList.contains("js-step-title-text")},this.iconType=function(){return e.isHidden()?"Minus":"Plus"},this.isOptional=function(){return this.stepIsOptional?" ; optional":""}},e.prototype.ComponentLinkClick=function(t,s,i,e){this.size=e,this.target=t.target,this.trackClick=function(){var t={label:this.target.getAttribute("href")+" : "+this.size},e=this.target.closest(".app-step-nav__list").getAttribute("data-length");e&&(t.dimension28=e),s.trackClick("stepNavLinkClicked",i,t)}},e.prototype.StepNavTracker=function(t,e,s){this.totalSteps=e,this.totalLinks=s,this.uniqueId=t,this.trackClick=function(t,e,s){window.GOVUK.analytics&&window.GOVUK.analytics.trackEvent&&((s=s||{}).dimension26=s.dimension26||this.totalSteps.toString(),s.dimension27=s.dimension27||this.totalLinks.toString(),s.dimension96=s.dimension96||this.uniqueId,window.GOVUK.analytics.trackEvent(t,e,s))}},t.AppStepNav=e}(window.GOVUK.Modules);